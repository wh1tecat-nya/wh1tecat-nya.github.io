version: 2
jobs:
  build:
    working_directory: ~/workspace
    docker:
      - image: circleci/node:8.11.2
    steps:
      - checkout
      - restore_cache:
          key: yarn-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: clone Pages
          command: git clone https://github.com/wh1tecat-nya/wh1tecat-nya.github.io.gits dist && cd dist && ls -a | grep -v -E '.git' | xargs rm -r && cd ..
      - run:
          name: Install dependencies package
          command: yarn
      - run:
          name: Build
          command: yarn build
      - run:
          name: Check dist
          command: ls -la dist
      - save_cache: # 追加
          key: yarn-{{ .Branch }}-{{ checksum "yarn.lock" }}
          paths:
            - ~/workspace/node_modules
      - add_ssh_keys:
          fingerprints:
            - "5d:b1:8a:84:9a:b9:bb:a5:64:74:5c:4e:0f:0e:cc:71"
      - deploy:
        name: Deploy
        command: cd dist && git add . && git commit -am "update pages" && git push origin master
